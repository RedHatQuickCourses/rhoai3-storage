<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Extending the Mesh: Database &amp; Custom Connections :: Red Hat OpenShift AI (RHOAI) Data Connectivity and Storage</title>
    <link rel="prev" href="storage-lab.html">
    <link rel="next" href="section5.html">
    <meta name="description" content="How to configure RHOAI 3 to manage credentials for Databases (PostgreSQL/MySQL) and Warehouses (Snowflake/Trino).">
    <meta name="generator" content="Antora 3.1.3">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://www.redhat.com" target="_blank"><img src="../../../_/img/redhat-logo.png" height="40px" alt="Red Hat"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="../../..">Red Hat OpenShift AI (RHOAI) Data Connectivity and Storage</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://github.com/RedHatQuickCourses/REPLACEREPONAME/issues" target="_blank">Report Issues</a>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="rhoai3-storage" data-version="3.2">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Red Hat OpenShift AI (RHOAI) Data Connectivity and Storage</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../index.html">Introduction &amp; Value</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="section1.html">Architecture Deep Dive</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="storage-lab.html">Create Data Conenctions</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="section3.html">Taxonomy &amp; Glossary</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="section5.html">Troubleshooting</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="quiz.html">Quiz</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Red Hat OpenShift AI (RHOAI) Data Connectivity and Storage</span>
    <span class="version">3.2</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../index.html">Red Hat OpenShift AI (RHOAI) Data Connectivity and Storage</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">3.2</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Red Hat OpenShift AI (RHOAI) Data Connectivity and Storage</a></li>
    <li><a href="section3.html">Taxonomy &amp; Glossary</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Extending the Mesh: Database &amp; Custom Connections</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph lead">
<p><strong>Data doesn&#8217;t just live in buckets. It lives in rows, columns, and transactions.</strong></p>
</div>
<div class="paragraph">
<p>In the previous labs, we focused on <strong>unstructured data</strong> (images, models, logs) stored in Object Storage. However, real-world AI often requires <strong>structured data</strong>â€”customer records in PostgreSQL, sales transactions in Snowflake, or feature vectors in Redis.</p>
</div>
<div class="paragraph">
<p>If you stop your automation at S3, your Data Scientists will go back to hardcoding database passwords.</p>
</div>
<div class="paragraph">
<p>In this module, you will learn how to extend the "AI Factory" to support <strong>Custom Connection Types</strong>. You will teach RHOAI how to speak "Database."</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_the_two_step_architecture"><a class="anchor" href="#_the_two_step_architecture"></a>The Two-Step Architecture</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Unlike S3 or OCI, which are built-in, RHOAI does not know what a "PostgreSQL" connection looks like by default. You must define it.</p>
</div>
<div class="paragraph">
<p>This requires a two-step workflow:
1.  <strong>Define the Standard (The Template):</strong> You create a <code>ConnectionType</code> resource that defines the schema (e.g., "I need a Host, a Port, and a Password").
2.  <strong>Provision the Access (The Instance):</strong> You create the <code>Secret</code> that fills in those blanks.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_step_1_define_the_connection_type"><a class="anchor" href="#_step_1_define_the_connection_type"></a>Step 1: Define the Connection Type</h2>
<div class="sectionbody">
<div class="paragraph">
<p>First, we must tell the RHOAI Dashboard how to render the form for a database connection and which environment variables to inject.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">#!/bin/bash
# define-postgres-type.sh
# Registers "PostgreSQL" as a valid Connection Type in RHOAI 3

echo "Defining 'Corporate PostgreSQL' connection type..."

cat &lt;&lt;EOF | oc apply -f -
apiVersion: dashboard.opendatahub.io/v1alpha
kind: ConnectionType
metadata:
  name: postgres-v1
  labels:
    opendatahub.io/dashboard: "true"
spec:
  displayName: "Corporate PostgreSQL"
  description: "Standard connection for corporate transactional databases."
  category: "Database"
  fields:
    - name: Host
      type: text
      required: true
      envVar: DB_HOST
    - name: Port
      type: text
      defaultValue: "5432"
      required: true
      envVar: DB_PORT
    - name: Database
      type: text
      required: true
      envVar: DB_NAME
    - name: Username
      type: text
      required: true
      envVar: DB_USER
    - name: Password
      type: password
      required: true
      envVar: DB_PASSWORD
EOF</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong><code>envVar</code>:</strong> This is the magic. It maps the form field "Host" to the environment variable <code>DB_HOST</code> inside the container.</p>
</li>
<li>
<p><strong><code>category</code>:</strong> Groups this under "Database" in the UI, separating it from Object Storage.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_step_2_create_the_data_connection"><a class="anchor" href="#_step_2_create_the_data_connection"></a>Step 2: Create the Data Connection</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Now that the type exists, you can provision credentials for a specific project (e.g., "Sales Read-Only").</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">#!/bin/bash
# connect-sales-db.sh &lt;project&gt;

PROJECT=$1
CONNECTION_NAME="sales-production-db"

echo "Creating Database Connection in $PROJECT..."

cat &lt;&lt;EOF | oc apply -n "$PROJECT" -f -
apiVersion: v1
kind: Secret
metadata:
  name: $CONNECTION_NAME
  labels:
    opendatahub.io/dashboard: "true"
    opendatahub.io/managed: "true"
  annotations:
    # Links to the Custom Type we created in Step 1
    opendatahub.io/connection-type: "postgres-v1"

    # User-friendly metadata
    openshift.io/display-name: "Sales Production DB (Read-Only)"
    openshift.io/description: "Access to the sales_transactions table."
type: Opaque
stringData:
  # These keys MUST match the 'fields' defined in the ConnectionType
  Host: "prod-db.internal.corp"
  Port: "5432"
  Database: "sales_data"
  Username: "readonly_user"
  Password: "super-secure-password"
EOF</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_the_payoff_why_do_this"><a class="anchor" href="#_the_payoff_why_do_this"></a>The Payoff: Why do this?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>By standardizing database access, you achieve <strong>Code Portability</strong>.</p>
</div>
<div class="sect2">
<h3 id="_the_shadow_it_way_hardcoded"><a class="anchor" href="#_the_shadow_it_way_hardcoded"></a>The "Shadow IT" Way (Hardcoded)</h3>
<div class="paragraph">
<p>The data scientist writes code that works <strong>only</strong> on their laptop or <strong>only</strong> in the Dev cluster.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python"># Fails when moved to production
conn = psycopg2.connect("host=192.168.1.5 dbname=sales user=admin ...")</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_the_factory_way_abstracted"><a class="anchor" href="#_the_factory_way_abstracted"></a>The "Factory" Way (Abstracted)</h3>
<div class="paragraph">
<p>The data scientist writes code that works anywhere.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">import os
import psycopg2

# Works in Dev (Sandbox DB) AND Prod (Warehouse DB)
# The Platform injects the correct values based on the environment.
conn = psycopg2.connect(
    host=os.getenv("DB_HOST"),
    database=os.getenv("DB_NAME"),
    user=os.getenv("DB_USER"),
    password=os.getenv("DB_PASSWORD")
)</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_summary"><a class="anchor" href="#_summary"></a>Summary</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Data Connections are not just for S3. They are your <strong>Universal Credential Broker</strong>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Platform Engineer:</strong> Defines the schema (<code>ConnectionType</code>).</p>
</li>
<li>
<p><strong>Security Team:</strong> Manages the secrets (<code>Secret</code>).</p>
</li>
<li>
<p><strong>Data Scientist:</strong> Consumes the environment variables (<code>os.getenv</code>).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Next Step: Now that you have connected all data types, let&#8217;s explore how to monitor storage usage.</strong></p>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="storage-lab.html">Create Data Conenctions</a></span>
  <span class="next"><a href="section5.html">Troubleshooting</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <img src="../../../_/img/rhl-logo-red.png" height="40px" alt="Red Hat"  href="https://redhat.com" >
</footer><script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
